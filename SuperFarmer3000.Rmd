---
title: "SuperFarmer"
author: "[Hanna Kranas](https://github.com/hansiu), [Joanna Zbijewska](https://github.com/joannazbijewska)"
date: "21 pazdziernika 2016"
output:
  html_document:
    toc: true
    depth: 3
    number_sections: true
    theme: united
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r global_options, include=FALSE}
knitr::opts_chunk$set(warning=FALSE,message =FALSE)
```
```{r load_packages, include=FALSE}
#library(microbenchmark)
library(ggplot2)
library('dplyr')
```
#**Definicje niezbednych wartosci**  
##Stada
```{r stada, results="hide"}
nazwy <- c('krolik','owca','swinia','krowa','kon','maly_pies','duzy_pies')
stado_glowne <- c(60,24,20,12,6,4,2)
stado <- c(0,0,0,0,0,0,0)
names(stado_glowne) <- nazwy
names(stado) <- nazwy
#####trzeba jeszcze zmienic stado[1] na stado['krolik']
```
##Kostki
```{r kostki, results="hide"}
kostka_zielona <- c('krolik','krolik','krolik','krolik','krolik','krolik','owca','owca','owca','swinia','krowa','wilk')
kostka_czerwona <- c('krolik','krolik','krolik','krolik','krolik','krolik','owca','owca','swinia','swinia','kon','lis')
```
#**Funkcje pomocnicze**  
##Funkcja liczaca ile otrzymamy ze stada glownego, z tego co nam sie nalezy
```{r licz}
daj_ze_stada_glownego_ile_sie_da <- function(sie_nalezy,stado,stado_glowne){
  if (all(sie_nalezy <= stado_glowne)){
    return(sie_nalezy)
  } else {
    sie_nalezy <- ifelse(sie_nalezy <= stado_glowne, sie_nalezy, stado_glowne)
    return(sie_nalezy)
  }
}
sie_nalezy <- c(1,25,0,0,0,5,0)
daj_ze_stada_glownego_ile_sie_da(sie_nalezy,stado,stado_glowne)


```
##Funkcja wykonujaca czynnosc przekazywania zwierzat miedzy stadem a stadem glownym
```{r wykonaj}
dodaj_lub_odejmij_zwierzeta <- function(co, jak='+',stado,stado_glowne){
  if (jak=='+'){ ## dodajemy do stada
    stado <- stado + co
    stado_glowne <- stado_glowne - co
  } else { ## odejmujemy ze stada
    stado <- stado - co
    stado_glowne <- stado_glowne + co
  }
  if (!all(stado+stado_glowne==c(60,24,20,12,6,4,2))){
    stop('!!! STADA SIE NIE SUMUJA!!!') ##przerywamy gre - stada sie nie sumuja
  }
  return(list(Stado=stado,Glowne=stado_glowne))
}
co <- daj_ze_stada_glownego_ile_sie_da(sie_nalezy,stado,stado_glowne)
NoweStany <- dodaj_lub_odejmij_zwierzeta(co,'+',stado,stado_glowne)
NoweStany
stado <- NoweStany$Stado
stado_glowne <- NoweStany$Glowne

```
##Funkcja sprawdzajaca czy stac nas na wygrana i zakanczajaca gre
```{r zakoncz_gre_jak_starcza, result="hide"}

####### trzeba zamienic tak, zeby bylo zgodnie z zasadami - jezeli nas stac, to trzeba po kolei zrobic wymiany

####### do poprawki, przydaloby sie to oprzec na wektorach wymian

###biecek cos mowil o switchach zeby je poprawic


zakoncz_gre_jak_starcza <- function(stado,stado_glowne){
  if(all(stado >= c(1,1,1,1,1,0,0))){
    return(TRUE) ## jesli mamy wiecej lub rowno zwierzat, to wygralismy
  } else { 
    suma = 0
    for (i in 1:7){
      switch(i,
             "1"={suma <- suma + stado[i]},
             "2"={suma <- suma + 6*stado[i]},
             "3"={suma <- suma + 12*stado[i]},
             "4"={suma <- suma + 36*stado[i]},
             "5"={suma <- suma + 72*stado[i]},
             "6"={suma <- suma + 6*stado[i]},
             "7"={suma <- suma + 36*stado[i]})
    }
    if (suma >= 127){ ##6+12+36+72+1 = 127 krolikow
      #stado <- c(suma-126,1,1,1,1,0,0)
      #stado_glowne <- (c(60,24,20,12,6,4,2) - stado)
      #tu trzeba dodac wymienianie
      return(TRUE) ## stac nas na wygrana, wiec tez wygralismy
    }
    return(FALSE) ## jeszcze za malo
  }
}
zakoncz_gre_jak_starcza(stado, stado_glowne)
```
#**Funkcje wymiany**  
##Funkcja sprawdzaj?ca czy jest ju? mo?liwe wzi?cie konia i kr?lika
```{r kon_starczanie}

##### moze trzeba w ogole usunac i ja dorobie nam do ramki danych wymiane czego sie da na konia??? 

##### tez do poprawki i oparcia na wektorach wymian

##podobna do zakoncz_gre_jak_starcza
wez_konia_jak_starcza <- function(stado,stado_glowne){
  suma = 0
  for (i in 1:7){
    switch(i,
           "1"={suma <- suma + stado[i]},
           "2"={suma <- suma + 6*stado[i]},
           "3"={suma <- suma + 12*stado[i]},
           "4"={suma <- suma + 36*stado[i]},
           "5"={suma <- suma},
           "6"={suma <- suma + 6*stado[i]},
           "7"={suma <- suma + 36*stado[i]},
           suma <- suma)
  }
  if (suma >= 73){
    NoweStany <- dodaj_lub_odejmij_zwierzeta(c(stado[1:4],0,stado[6:7]),'-',stado,stado_glowne)
    stado <- NoweStany$Stado
    stado_glowne <- NoweStany$Glowne
    ##usuwamy wszystko ze stada, zeby wymienic na konia i krolika
    if ((suma-72)<=60){
      NoweStany <- dodaj_lub_odejmij_zwierzeta(c((suma-72),0,0,0,1,0,0),'+',stado,stado_glowne)
      stado <- NoweStany$Stado
      stado_glowne <- NoweStany$Glowne
      #bierzemy konia, a reszt? w krolikach
    } else {
      while((suma-72)>60){
        NoweStany <- dodaj_lub_odejmij_zwierzeta(c(0,1,0,0,0,0,0),'+',stado,stado_glowne)
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
        suma <- suma - 6
        ##je?li zabraknie kr?lik?w, to bierzemy jeszcze w owcach
      }
      NoweStany <- dodaj_lub_odejmij_zwierzeta(c((suma-72),0,0,0,1,0,0),'+',stado,stado_glowne)
      stado <- NoweStany$Stado
      stado_glowne <- NoweStany$Glowne
    }
  } 
  ## jesli nie starczy to nie robimy nic
  return(list(Stado=stado,Glowne=stado_glowne))
}
NoweStany <- wez_konia_jak_starcza(stado, stado_glowne)
stado <- NoweStany$Stado
stado_glowne <- NoweStany$Glowne
```
#**Ramka danych do wymian**   
## Tworzenie ramki danych
```{r dane_do_wymian,results="hide",include=FALSE}
##To bedzie pierwsza kolumna naszej ramki danych - co chcemy wymieniac
co <- c("krolik","krolik","krolik","krolik","krolik","owca","owca","owca","owca","owca","owca","swinia","swinia","swinia","swinia","swinia","swinia","swinia","swinia","swinia","krowa","krowa","krowa","krowa","krowa","krowa","krowa","krowa","krowa","krowa","krowa","krowa","krowa","krowa","maly_pies","maly_pies","maly_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","duzy_pies","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon","kon")
##To bedzie druga kolumna naszej ramki danych - na co chcemy wymieniac
na_co <- c("owca","swinia","krowa","maly_pies","duzy_pies","krolik","swinia","krowa","kon","maly_pies","duzy_pies","krolik","owca","krowa","kon","maly_pies","duzy_pies","owca+krolik","owca+maly_pies","maly_pies+krolik","krolik","owca","swinia","kon","duzy_pies","krolik+owca","krolik+owca+swinia","krolik+swinia","krolik+owca+maly_pies","krolik+swinia+maly_pies","swinia+owca","swinia+maly_pies","swinia+owca+maly_pies","swinia+owca+maly_pies+krolik","krolik","owca","swinia","krolik","owca","swinia","krowa","kon","krolik+owca","krolik+owca+swinia","krolik+swinia","krolik+owca+maly_pies","krolik+swinia+maly_pies","swinia+owca","swinia+maly_pies","swinia+owca+maly_pies","swinia+owca+maly_pies+krolik","owca","swinia","krowa","duzy_pies","krowa+duzy_pies","krowa+swinia","krowa+swinia+owca","krowa+swinia+maly_pies","krowa+swinia+owca+maly_pies","krowa+krolik","krowa+swinia+krolik","krowa+swinia+owca+krolik","krowa+swinia+maly_pies+krolik","swinia+owca","swinia+maly_pies","swinia+owca+maly_pies","swinia+owca+maly_pies+krolik","swinia+maly_pies+krolik","swinia+owca+krolik","owca+maly_pies","owca+krolik","owca+maly_pies+krolik","maly_pies+krolik","duzy_pies+swinia","duzy_pies+swinia+owca","duzy_pies+swinia+maly_pies","duzy_pies+swinia+owca+maly_pies","duzy_pies+krolik","duzy_pies+swinia+krolik","duzy_pies+swinia+owca+krolik","duzy_pies+swinia+maly_pies+krolik")
##To bÄ™dÄ… wektory, ktore trzeba bedzie odejmowac ze stada - trzecia kolumna danych.
za_ile <- c("6,0,0,0,0,0,0","12,0,0,0,0,0,0","36,0,0,0,0,0,0","12,0,0,0,0,0,0","36,0,0,0,0,0,0","0,1,0,0,0,0,0","0,2,0,0,0,0,0","0,6,0,0,0,0,0","0,12,0,0,0,0,0","0,1,0,0,0,0,0","0,6,0,0,0,0,0","0,0,1,0,0,0,0","0,0,1,0,0,0,0","0,0,3,0,0,0,0","0,0,6,0,0,0,0","0,0,1,0,0,0,0","0,0,3,0,0,0,0","0,0,1,0,0,0,0","0,0,1,0,0,0,0","0,0,1,0,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,2,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,1,0,0,0","0,0,0,0,0,1,0","0,0,0,0,0,1,0","0,0,0,0,0,2,0","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,2","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,0,0,1","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0","0,0,0,0,1,0,0")
##To bÄ™dzie ostatnia kolumna ramki danych - wektory z otrzymanymi zwierzetami.
co_z_tego <- c("0,1,0,0,0,0,0","0,0,1,0,0,0,0","0,0,0,1,0,0,0","0,0,0,0,0,1,0","0,0,0,0,0,0,1","6,0,0,0,0,0,0","0,0,1,0,0,0,0","0,0,0,1,0,0,0","0,0,0,0,1,0,0","0,0,0,0,0,1,0","0,0,0,0,0,0,1","12,0,0,0,0,0,0","0,2,0,0,0,0,0","0,0,0,1,0,0,0","0,0,0,0,1,0,0","0,0,0,0,0,1,0","0,0,0,0,0,0,1","6,1,0,0,0,0,0","0,1,0,0,0,1,0","6,0,0,0,0,1,0","36,0,0,0,0,0,0","0,6,0,0,0,0,0","0,0,3,0,0,0,0","0,0,0,0,1,0,0","0,0,0,0,0,0,1","30,1,0,0,0,0,0","18,1,1,0,0,0,0","24,0,1,0,0,0,0","24,1,0,0,0,1,0","18,0,1,0,0,1,0","0,2,2,0,0,0,0","0,0,2,0,0,2,0","0,1,2,0,0,1,0","12,1,1,0,0,1,0","6,0,0,0,0,0,0","0,1,0,0,0,0,0","0,0,1,0,0,0,0","36,0,0,0,0,0,0","0,6,0,0,0,0,0","0,0,3,0,0,0,0","0,0,0,1,0,0,0","0,0,0,0,1,0,0","30,1,0,0,0,0,0","18,1,1,0,0,0,0","24,0,1,0,0,0,0","24,1,0,0,0,1,0","18,0,1,0,0,1,0","0,2,2,0,0,0,0","0,0,2,0,0,2,0","0,1,2,0,0,1,0","12,1,1,0,0,1,0","0,24,0,0,0,0,0","0,0,6,0,0,0,0","0,0,0,2,0,0,0","0,0,0,0,0,0,2","0,0,0,1,0,0,1","0,0,3,1,0,0,0","0,4,1,1,0,0,0","0,0,2,1,0,2,0","0,3,1,1,0,1,0","36,0,0,1,0,0,0","24,0,1,1,0,0,0","18,1,1,1,0,0,0","18,0,1,1,0,1,0","0,6,3,0,0,0,0","0,0,4,0,0,4,0","0,5,3,0,0,1,0","24,1,3,0,0,1,0","48,0,1,0,0,1,0","42,2,1,0,0,0,0","0,23,0,0,0,1,0","36,6,0,0,0,0,0","36,5,0,0,0,1,0","60,0,0,0,0,2,0","0,0,3,0,0,0,1","0,4,1,0,0,0,1","0,0,2,0,0,2,1","0,3,1,0,0,1,1","36,0,0,0,0,0,1","24,0,1,0,0,0,1","18,1,1,0,0,0,1","18,0,1,0,0,1,1")
```
## Ramka sklada sie z 4 kolumn i 82 wierszy odpowiadajacych roznym sposobom wymiany zwierzat
```{r dane_wymian}
dane_wymian <- data.frame(co,na_co,za_ile,co_z_tego)
colnames(dane_wymian) = c("Co","Na_co","Za_ile","Co_z_tego")
head(dane_wymian,12)
```
#**Funkcja wymiany**  
##Funkcja korzystajac z przygotowanej ramki danych dokonuje wymiany, jezeli ilosc zwierzat w stadzie i stadzie glownym jest wystarczajaca
```{r wymiana}
##przyjmuje wartosci z - jakie zwierze chcemy wymienic oraz na - na jakie zwirzaki chcemy wymienic (jesli wiecej niz jedno nalezy wpisac je z "+" pomiedzy)
wymiana <- function(z = NA,na = NA,stado,stado_glowne){
  ##filtruje nasza ramke danych najpierw ze wzgledu na zwierze wymieniane, pozniej ze   wzgledu na wybrane zwierzeta, ktore chcemy uzyskac
  if(is.na(z)){
    FALSE
  } else {
    wymieniany_zwierzak <- filter(dane_wymian, Co %in% z)
  }
  if(is.na(na)){
    FALSE
  } else {
    nasza_wymiana <- filter(wymieniany_zwierzak, Na_co %in% na)
  }
  ##uzyskanie z ramki danych wartosci wektorow zaplaty i uzyskanych zwirzat
  zaplata <- as.numeric(unlist(strsplit(as.character(nasza_wymiana$Za_ile),",")))
  uzysk <- as.numeric(unlist(strsplit(as.character(nasza_wymiana$Co_z_tego),",")))
  ##dodaje i odejmuje odpowiednie wartosci ze stada i stada glownego
  NoweStany <- dodaj_lub_odejmij_zwierzeta(zaplata,'-',stado,stado_glowne)
  NoweStany <- dodaj_lub_odejmij_zwierzeta(uzysk,'+',NoweStany$Stado,NoweStany$Glowne)
  stado <- NoweStany$Stado
  stado_glowne <- NoweStany$Glowne
  ##Tutaj dodajemy warunek, zeby nie wymienialo sie, gdy juz nie mozna.
  if(!all(stado>=c(0,0,0,0,0,0,0)) || !all(stado_glowne>=c(0,0,0,0,0,0,0))){
    NoweStany <- dodaj_lub_odejmij_zwierzeta(zaplata,'+',stado,stado_glowne)
    NoweStany <- dodaj_lub_odejmij_zwierzeta(uzysk,'-',NoweStany$Stado,NoweStany$Glowne)
    stado <- NoweStany$Stado
    stado_glowne <- NoweStany$Glowne
  }
  return(list(Stado=stado,Glowne=stado_glowne))
}
NoweStany <- wymiana('krolik','swinia',stado,stado_glowne)
NoweStany
stado <- NoweStany$Stado
stado_glowne <- NoweStany$Glowne
```
#**Funkcje rzutow**  
##Rzut kostkami
```{r losowanie}
##losowanie rzutu
losuj_rzut_kostek <- function(a=kostka_zielona,b=kostka_czerwona){
  wynik <- c(sample(a, 1), sample(b, 1))
  return(wynik)
}
k <- losuj_rzut_kostek()
cat(k)
##zamiana wyniku rzutu na wektor analogiczny do wektor?w stad

##########biecek cos mowil o switchach zeby je poprawic


zamien_wynik_rzutu_na_wektor <- function(wynik){
  switch(wynik[1], ##Najpierw wynik z pierwszej kosci
         krolik={c1 <- c(1,0,0,0,0,0,0)},
         owca={c1 <- c(0,1,0,0,0,0,0)},
         swinia={c1 <- c(0,0,1,0,0,0,0)},
         krowa={c1 <- c(0,0,0,1,0,0,0)},
         {c1 <- c(0,0,0,0,0,0,0)}
  )
  switch(wynik[2], ##Pozniej wynik z drugiej kosci
         krolik={c2 <- c(1,0,0,0,0,0,0)},
         owca={c2 <- c(0,1,0,0,0,0,0)},
         swinia={c2 <- c(0,0,1,0,0,0,0)},
         H={c2 <- c(0,0,0,0,1,0,0)},
         {c2 <- c(0,0,0,0,0,0,0)}
  )
  z_rzutu <- (c1+c2)
  return(z_rzutu)
}
zamien_wynik_rzutu_na_wektor(k)
```
##Przeprowadzenie atakow drapieznikow
```{r drapiezniki}
atak_drapieznika <- function(lis = FALSE, wilk = FALSE,stado,stado_glowne){
  if (wilk == TRUE ){ ##wilk!
    if (stado[7]>0){ ## sprawdzenie posiadania du?ego psa
      NoweStany <- dodaj_lub_odejmij_zwierzeta(c(0,0,0,0,0,0,1),'-',stado,stado_glowne) ## to oznacza: jeden duzy pies. odejmij od stada (dodaj do glownego)
      stado <- NoweStany$Stado
      stado_glowne <- NoweStany$Glowne
    } else {
      NoweStany <- dodaj_lub_odejmij_zwierzeta(c(stado[1:4],0,0,0),'-',stado,stado_glowne) ## to oznacza: wszystkie zwierzeta oprocz konia i psow ktore sa w stadzie. odejmij od stada (dodaj do glownego)
      stado <- NoweStany$Stado
      stado_glowne <- NoweStany$Glowne
    }
  }
  if (lis == TRUE ){ ##lis!
    if (stado[6]>0){ ## sprawdzenie posiadania mia?ego psa
      NoweStany <- dodaj_lub_odejmij_zwierzeta(c(0,0,0,0,0,1,0),'-',stado,stado_glowne) ## to oznacza: jeden maly pies. odejmij od stada (dodaj do glownego)
      stado <- NoweStany$Stado
      stado_glowne <- NoweStany$Glowne
    } else {
      NoweStany <- dodaj_lub_odejmij_zwierzeta(c(stado[1],0,0,0,0,0,0),'-',stado,stado_glowne) ## to oznacza: wszystkie kroliki ktore sa w stadzie. odejmij od stada (dodaj do glownego)
      stado <- NoweStany$Stado
      stado_glowne <- NoweStany$Glowne
    }
  }
  return(list(Stado=stado,Glowne=stado_glowne))
}
NoweStany <- atak_drapieznika(TRUE,FALSE,stado,stado_glowne)
stado <- NoweStany$Stado
stado_glowne <- NoweStany$Glowne
NoweStany
```
##Dokonywanie rzutu i akcji z nim zwi?zanych
```{r rzucanie, results="hide", eval=FALSE}
rzuc_i_zareaguj <- function(stado, stado_glowne){
  otrzymane<-c(0,0,0,0,0,0,0)
  kostki<-losuj_rzut_kostek()
  ##je?li stado puste nie trzeba sprawdza? drapie?nikow
  if (all(stado==0)){
    if (kostki[1]==kostki[2]){ ##sprawdzenie czy kostki stado? sobie r?wne
      otrzymane <- daj_ze_stada_glownego_ile_sie_da((zamien_wynik_rzutu_na_wektor(kostki))/2,stado,stado_glowne)
    }
    ## je?li nie stado? sobie rowne to nic nie dostajemy
  } else {
    if ('wilk' %in% kostki){
      if ('lis' %in% kostki) {
        NoweStany <-atak_drapieznika(TRUE,TRUE,stado,stado_glowne) ##atak wilka z lisem!
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
      } else {
        NoweStany <- atak_drapieznika(FALSE,TRUE,stado,stado_glowne) ##atak wilka
        wylosowane <- zamien_wynik_rzutu_na_wektor(kostki) ## ale moglismy sie obronic i na drugiej kosci cos wylosowac korzystnego
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
        otrzymane <- ifelse(wylosowane == 0, 0, trunc((stado+wylosowane)/2)) ## przeliczamy kostki wg. zasady n/2
        otrzymane <- daj_ze_stada_glownego_ile_sie_da(otrzymane,stado,stado_glowne)
      }
    } else {
      if ('lis' %in% kostki) { ## atak lisa
        NoweStany <- atak_drapieznika(TRUE,FALSE,stado,stado_glowne)
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
      }
      wylosowane <- zamien_wynik_rzutu_na_wektor(kostki)
      otrzymane <- ifelse(wylosowane == 0, 0, trunc((stado+wylosowane)/2)) ## przeliczamy kostki wg. zasady n/2
      otrzymane <- daj_ze_stada_glownego_ile_sie_da(otrzymane,stado,stado_glowne)
    } 
  }
  if (!all(otrzymane==0)){
    NoweStany <- dodaj_lub_odejmij_zwierzeta(otrzymane,'+',stado,stado_glowne) ##przekazanie wyniku rzutu miedzy stadami
    stado <- NoweStany$Stado
    stado_glowne <- NoweStany$Glowne
  }
  return(list(Stado=stado,Glowne=stado_glowne))
}
```
```{r rzucaniefalse, echo=FALSE}
rzuc_i_zareaguj <- function(stado, stado_glowne){
  otrzymane<-c(0,0,0,0,0,0,0)
  kostki<-c('krolik','krolik')
  ##je?li stado puste nie trzeba sprawdza? drapie?nikow
  if (all(stado==0)){
    if (kostki[1]==kostki[2]){ ##sprawdzenie czy kostki stado? sobie r?wne
      otrzymane <- daj_ze_stada_glownego_ile_sie_da((zamien_wynik_rzutu_na_wektor(kostki))/2,stado,stado_glowne)
    }
    ## je?li nie stado? sobie rowne to nic nie dostajemy
  } else {
    if ('wilk' %in% kostki){
      if ('lis' %in% kostki) {
        NoweStany <-atak_drapieznika(TRUE,TRUE,stado,stado_glowne) ##atak wilka z lisem!
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
      } else {
        NoweStany <- atak_drapieznika(FALSE,TRUE,stado,stado_glowne) ##atak wilka
        wylosowane <- zamien_wynik_rzutu_na_wektor(kostki) ## ale moglismy sie obronic i na drugiej kosci cos wylosowac korzystnego
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
        otrzymane <- ifelse(wylosowane == 0, 0, trunc((stado+wylosowane)/2)) ## przeliczamy kostki wg. zasady n/2
        otrzymane <- daj_ze_stada_glownego_ile_sie_da(otrzymane,stado,stado_glowne)
      }
    } else {
      if ('lis' %in% kostki) { ## atak lisa
        NoweStany <- atak_drapieznika(TRUE,FALSE,stado,stado_glowne)
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
      }
      wylosowane <- zamien_wynik_rzutu_na_wektor(kostki)
      otrzymane <- ifelse(wylosowane == 0, 0, trunc((stado+wylosowane)/2)) ## przeliczamy kostki wg. zasady n/2
      otrzymane <- daj_ze_stada_glownego_ile_sie_da(otrzymane,stado,stado_glowne)
    } 
  }
  if (!all(otrzymane==0)){
    NoweStany <- dodaj_lub_odejmij_zwierzeta(otrzymane,'+',stado,stado_glowne) ##przekazanie wyniku rzutu miedzy stadami
    stado <- NoweStany$Stado
    stado_glowne <- NoweStany$Glowne
  }
  return(list(Stado=stado,Glowne=stado_glowne))
}
```
```{r}
NoweStany <- rzuc_i_zareaguj(stado, stado_glowne)
NoweStany
stado <- NoweStany$Stado
stado_glowne <- NoweStany$Glowne
```
```{r rzucanietrue, results="hide", echo=FALSE}
rzuc_i_zareaguj <- function(stado, stado_glowne){
  otrzymane<-c(0,0,0,0,0,0,0)
  kostki<-losuj_rzut_kostek()
  ##je?li stado puste nie trzeba sprawdza? drapie?nikow
  if (all(stado==0)){
    if (kostki[1]==kostki[2]){ ##sprawdzenie czy kostki stado? sobie r?wne
      otrzymane <- daj_ze_stada_glownego_ile_sie_da((zamien_wynik_rzutu_na_wektor(kostki))/2,stado,stado_glowne)
    }
    ## je?li nie stado? sobie rowne to nic nie dostajemy
  } else {
    if ('wilk' %in% kostki){
      if ('lis' %in% kostki) {
        NoweStany <-atak_drapieznika(TRUE,TRUE,stado,stado_glowne) ##atak wilka z lisem!
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
      } else {
        NoweStany <- atak_drapieznika(FALSE,TRUE,stado,stado_glowne) ##atak wilka
        wylosowane <- zamien_wynik_rzutu_na_wektor(kostki) ## ale moglismy sie obronic i na drugiej kosci cos wylosowac korzystnego
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
        otrzymane <- ifelse(wylosowane == 0, 0, trunc((stado+wylosowane)/2)) ## przeliczamy kostki wg. zasady n/2
        otrzymane <- daj_ze_stada_glownego_ile_sie_da(otrzymane,stado,stado_glowne)
      }
    } else {
      if ('lis' %in% kostki) { ## atak lisa
        NoweStany <- atak_drapieznika(TRUE,FALSE,stado,stado_glowne)
        stado <- NoweStany$Stado
        stado_glowne <- NoweStany$Glowne
      }
      wylosowane <- zamien_wynik_rzutu_na_wektor(kostki)
      otrzymane <- ifelse(wylosowane == 0, 0, trunc((stado+wylosowane)/2)) ## przeliczamy kostki wg. zasady n/2
      otrzymane <- daj_ze_stada_glownego_ile_sie_da(otrzymane,stado,stado_glowne)
    } 
  }
  if (!all(otrzymane==0)){
    NoweStany <- dodaj_lub_odejmij_zwierzeta(otrzymane,'+',stado,stado_glowne) ##przekazanie wyniku rzutu miedzy stadami
    stado <- NoweStany$Stado
    stado_glowne <- NoweStany$Glowne
  }
  return(list(Stado=stado,Glowne=stado_glowne))
}
```
#**Przeprowadzenie calej gry**  
```{r}

#######trzeba rozbic na funkcje strategia() i funkcje zagraj(strategia())
## trzeba dodac liczenie rzutow


zagraj <- function() {
  stado_glowne <- c(60, 24, 20, 12, 6, 4, 2)
  stado <- c(0, 0, 0, 0, 0, 0, 0)
  names(stado_glowne) <- nazwy
  names(stado) <- nazwy
  kroki = 0
  repeat {
    if (!all(stado == 0)) {
      ##jesli stado jest niepuste sprawdzamy czy nie oplaca sie czegos wymienic
      NoweStany <- wez_konia_jak_starcza(stado, stado_glowne)
      stado <- NoweStany$Stado
      stado_glowne <-
        NoweStany$Glowne ##najpierw sprawdzamy czy starczy na konia i krolika
      if (stado[1] > 6) {
        ##wiecej niz 6 krolikow
        if ((stado[6] == 0) &
            (stado[1] >= 9)) {
          ##wiecej niz 9 krolikow i brak malego psa, to bierzemy malego psa
          NoweStany <-
            wymiana('krolik', 'maly_pies', stado, stado_glowne)
          stado <- NoweStany$Stado
          stado_glowne <- NoweStany$Glowne
        }
        if (stado[2] > 0) {
          #jesli juz mamy owce, to wymieniamy na nie kroliki
          NoweStany <- wymiana('krolik', 'owca', stado, stado_glowne)
          stado <- NoweStany$Stado
          stado_glowne <- NoweStany$Glowne
        }
      } else {
        if ((stado[2] > 2) &
            (stado[1] == 0)) {
          ##nie mamy krolikow, ale wiecej niz 3 owce i brak malego psa !!!to jest niezgodne z zasadami - moze jak mamy wiecej niz dwie owce, to jedna na malego psa????
          NoweStany <-
            wymiana('owca', 'maly_pies', stado, stado_glowne)
          stado <- NoweStany$Stado
          stado_glowne <- NoweStany$Glowne
        }
        if ((stado[3] > 0) &
            (stado[6])) {
          ##jezli mamy swinie ale brak malego psa
          ## wymieniamy swinie na owce i malego_psa
          NoweStany <- wymiana('swinia', 'owca+maly_pies', stado, stado_glowne)
          stado <- NoweStany$Stado
          stado_glowne <- NoweStany$Glowne
        }
      }
    }
    NoweStany <- rzuc_i_zareaguj(stado, stado_glowne)
    stado <- NoweStany$Stado
    stado_glowne <- NoweStany$Glowne
    kroki <- kroki + 1
    if (zakoncz_gre_jak_starcza(stado, stado_glowne) == TRUE) {
      ##trzeba zmienic na zgodne z wymianami
      return(kroki)
    }
  }
}
```
#**Czas gry**
```{r echo=FALSE}
wyniki <- as.data.frame(replicate(10000,zagraj())) #chwilowo mniej dla wygody
summary(wyniki) ##### jak robie summarise/ze to pisze ¿e ramka danych z zerow¹ liczba kolumn i 0 wierszami
ggplot(data=wyniki, aes(wyniki)) + geom_histogram(binwidth = 1,
                 col="blue", 
                 fill="green") + 
  labs(title="Rozklad czasu gry") +
  labs(x="Czas gry [kroki]", y="Liczba gier")

## jak to usuwamy to trzeba i library(microbenchmark usun??)
#mierz_czas <- microbenchmark({zagraj()}, times=10000)
#boxplot(mierz_czas, xlab="Pojedyncza gra - zagraj()", ylab='Czas pojedynczej gry',main='Czas trwania gry SuperFarmer')
#autoplot(mierz_czas, main='Czas trwania gry SuperFarmer')
#qplot(y=time,data=mierz_czas,color='red',xlab="zagraj()", ylab="Czas gry",main='Czas trwania gry SuperFarmer') + scale_y_log10()
#print(mierz_czas)

```
```{r eval=FALSE, echo=FALSE}
##testy
##################
rzuc_i_zareaguj()
#cat(stado)
#cat(stado_glowne)
rzuc_i_zareaguj()
#cat(stado)
#cat(stado_glowne)
rzuc_i_zareaguj()
#cat(stado)
#cat(stado_glowne)
rzuc_i_zareaguj()
#cat(stado)
#cat(stado_glowne)
rzuc_i_zareaguj()
#cat(stado)
#cat(stado_glowne)
rzuc_i_zareaguj()
#cat(stado)
#cat(stado_glowne)
##################
stado <- c(7,2,0,0,0,0,0)
stado_glowne <- c(53,22,20,12,6,4,2)
wymiana_swinia('owca')
wymiana('owca','swinia')
#cat(stado)
#cat(stado_glowne)
wymiana_swinia('owca')
wymiana('owca','swinia')
#cat(stado)
#cat(stado_glowne)
stado <- c(36,0,1,0,0,0,0)
stado_glowne <- c(24,24,19,12,6,4,2)
wymiana_krowa('krolik')
wymiana('krolik','krowa')
#cat(stado)
#cat(stado_glowne)
wymiana_duzy_pies('swinia')
wymiana('swinia','duzy_pies')
#cat(stado)
#cat(stado_glowne)
stado <- c(5,2,3,0,0,0,0)
stado_glowne <- c(55,22,17,12,6,4,2)
owce_na_kroliki(TRUE)
wymiana('krolik','owca')
#cat(stado)
#cat(stado_glowne)
swinie_na_owce(TRUE)
wymiana('owca','swinia')
#cat(stado)
#cat(stado_glowne)
owce_na_kroliki(TRUE)
wymiana('krolik','owca')
#cat(stado)
#cat(stado_glowne)
owce_na_kroliki(TRUE)
wymiana('krolik','owca')
#cat(stado)
#cat(stado_glowne)
stado <- c(57,1,0,0,0,0,0)
stado_glowne <- c(3,23,20,12,6,4,2)
owce_na_kroliki(TRUE)
wymiana('krolik','owca')
#cat(stado)
#cat(stado_glowne)
swinie_na_owce(TRUE)
wymiana('owca','swinia')
#cat(stado)
#cat(stado_glowne)
```
